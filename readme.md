 

# 🚀 分布式双擎自动化下载终端 (Dual-Engine Download RPA)

本项目是一个专为复杂网络环境和虚拟机（VM）挂机设计的**分布式机器人流程自动化（RPA）系统**。采用“控制端（纯视觉大脑）”与“执行端（YAML配置四肢）”高度解耦的 C/S 架构，旨在实现 24/7 无人值守的自动化下载任务流。

## ✨ 核心需求与实现目标

根据业务场景，本项目成功实现了以下核心定制需求：

1. **分布式跨平台执行**：Win11 物理机（AMD 8845HS）作为服务端提供视觉算力，Win10 局域网虚拟机作为客户端负责轻量级挂机与点击。
2. **YAML 动态驱动与无状态大脑**：服务端不再存储任何图片模板，纯粹作为“视觉算力 API”运行。客户端通过 `config.yaml` 动态定义任务流，随时新增点击目标而无需修改或重启服务端代码。
3. **极速状态监控机制**：针对局域网共享路径 (`\\One\d\downloadD`) 进行深度 I/O 优化。仅扫描表层及“最近5分钟内有修改”的子文件夹，寻找 `.qkdownloading` 后缀，极大地降低了网络扫描的延迟和卡顿。
4. **混合双擎视觉定位**：
* **引擎 1 (主)**：基于 OpenCV 的彩色模板精确匹配，服务端直接解析字节流，速度极快（<20ms）。
* **引擎 2 (备)**：基于 RapidOCR 的全屏极速文字识别。当 UI 更新、图片失效或变形时，自动无缝降级为文字查找（如寻找“下载”、“获取”），保证任务永不中断。


5. **高鲁棒性防御**：内置图像通道数强制转换防御（利用 `cv2.IMREAD_COLOR` 解决匹配崩溃问题），以及防抖动二次确认机制（避免任务切换间隙的误判）。

---

## 📂 项目结构

```text
auto_download_rpa/
│
├── server/                    # 部署于 Win11 宿主机 (纯视觉算力大脑)
│   └── server.py              # Flask 服务端主程序 (提供视觉解算 API)
│
└── client/                    # 部署于 Win10 虚拟机 (YAML驱动四肢)
    ├── client.py              # 客户端主程序 (状态机轮询、截图、上传解算、模拟点击)
    ├── config.yaml            # 自动化任务流配置文件 (自动生成)
    └── templates/             # 存放 OpenCV 匹配所需的彩色局部截图
        ├── btn_download.png   # "下载" 按钮截图模板
        └── btn_get.png        # "获取" 按钮截图模板

```

---

## 🛠️ 部署与环境安装

本项目分为服务端和客户端，需分别在对应的机器上安装依赖并运行。

### 1. 服务端部署 (Win11 物理机)

服务端主要负责图像匹配和 OCR 识别，需要较高的计算资源。

```bash
# 激活你的 Python 虚拟环境后，执行以下命令安装依赖：
pip install flask opencv-python numpy rapidocr_onnxruntime

```

**运行服务**：

```bash
python server.py
# 默认将在 0.0.0.0:5010 开启服务，请确保防火墙已放行该端口。

```

### 2. 客户端部署 (Win10 虚拟机)

客户端极度轻量，负责截图、发送请求和执行鼠标点击。

```bash
# 安装轻量级客户端依赖 (需补充安装 pyyaml 用于读取配置)：
pip install mss requests pyautogui pyyaml

```

**运行与配置**：

```bash
python client.py

```

> **💡 提示**：首次运行 `client.py` 时，会在当前目录自动生成 `config.yaml` 文件和 `templates/` 文件夹。你可以随时打开 `config.yaml` 修改服务器 IP、下载监控目录，或自定义新增自动化点击任务，**全程无需修改代码**！

---

## 🛡️ 安全提示

客户端内置了 **PyAutoGUI 防故障安全锁 (Fail-Safe)**。在客户端自动化运行期间，如果发生失控，**请迅速将鼠标移动到屏幕的任意四个角落之一**，程序将立即抛出异常并强制中断。

---
 